package com.vandersoncamp.bankslip.service;import com.vandersoncamp.bankslip.model.EntityID;import com.vandersoncamp.bankslip.util.JpaCriteriaHelper;import javax.ejb.TransactionAttribute;import javax.ejb.TransactionAttributeType;import javax.inject.Inject;import javax.persistence.EntityManager;import javax.persistence.EntityNotFoundException;import javax.validation.Valid;import java.util.Arrays;import java.util.List;public abstract class GenericService<T extends EntityID, I> {    private Class<T> entityClass;    @Inject    private EntityManager em;    protected GenericService() {    }    public GenericService(Class<T> entityClass) {        this.entityClass = entityClass;    }    @TransactionAttribute(TransactionAttributeType.REQUIRED)    public T create(@Valid T entity) {        em.persist(entity);        return entity;    }    @TransactionAttribute(TransactionAttributeType.REQUIRED)    public T update(@Valid T entity) {        T oldBean = em.find(entityClass, entity.getId());        if (oldBean == null) {            throw new EntityNotFoundException();        }        return em.merge(entity);    }    @TransactionAttribute(TransactionAttributeType.REQUIRED)    public void delete(I id) {        T entity = em.getReference(entityClass, id);        em.remove(entity);    }    public Boolean exists(Object id) {        Boolean exists = false;        T bean = em.find(entityClass, id);        if (bean != null) {            exists = true;        }        return exists;    }    private boolean nomEmpty(String... values) {        for (String val : values) {            if (val == null || val.trim().isEmpty()) {                return false;            }        }        return true;    }    private List<String> asListString(String value) {        return Arrays.asList(value.split("\\."));    }    public List<T> findAll(Integer pageSize, Integer pageNumber, String filterField, String filterData, String order) {        JpaCriteriaHelper helper = JpaCriteriaHelper.select(em, entityClass);        if (pageSize != null && pageNumber != null) {            helper.setPageSize(pageSize)                    .page(pageNumber);        }        if (nomEmpty(filterField, filterData)) {            helper.where(asListString(filterField), JpaCriteriaHelper.ComparatorOperator.LIKE_IGNORE_CASE, filterData.replaceAll("\\b", "%"));        }        if (nomEmpty(order)) {            String[] parts = order.split("\\+");            helper.orderBy(parts[0]);            if (parts.length > 1 && parts[1].equalsIgnoreCase("desc")) {                helper.desc();            }        }        return helper.getResults();    }    public List<T> findAll(String filterField, String filterData, String order) {        return findAll(null, null, filterField, filterData, order);    }    public T find(I id) {        T bean = em.find(entityClass, id);        if (bean == null) {            throw new EntityNotFoundException();        }        return bean;    }    public T find(String id) {        T bean = em.find(entityClass, id);        if (bean == null) {            throw new EntityNotFoundException();        }        return bean;    }}